---
interface Props {
	id: string;
}

const { id } = Astro.props;
---

<style is:global>
	body {
		--pagefind-ui-scale: 0.85;
		--pagefind-ui-primary: #034ad8;
		--pagefind-ui-text: #393939;
		--pagefind-ui-background: #ffffff;
		--pagefind-ui-border: #eeeeee;
		--pagefind-ui-tag: #eeeeee;
		--pagefind-ui-border-width: 2px;
		--pagefind-ui-border-radius: 1rem;
		--pagefind-ui-image-border-radius: 8px;
		--pagefind-ui-image-box-ratio: 3 / 2;
		--pagefind-ui-font: "Outfit", sans-serif;
	}

	body.dark {
		--pagefind-ui-primary: #eeeeee;
		--pagefind-ui-text: #eeeeee;
		--pagefind-ui-background: #152028;
		--pagefind-ui-border: #152028;
		--pagefind-ui-tag: #152028;
	}

	.pagefind-ui form .pagefind-ui__search-input {
		font-family: "Outfit", sans-serif;
		font-weight: 500;
		font-size: 1rem;
		border-radius: 0.5rem;
		border: none;
		outline: rgb(from var(--color-foreground) r g b / 0.75) solid 2px;
	}

	.pagefind-ui .pagefind-ui__result-title {
		font-size: 1rem;
		font-weight: 600;
	}

	.pagefind-ui .pagefind-ui__message {
		font-weight: 500;
	}

	dialog {
		position: fixed;
		left: 50%;
		top: 50%;
		border-radius: 0.5rem;
		transform: translate(-50%, -50%);
	}

	dialog::backdrop {
		position: fixed;
		top: 0px;
		right: 0px;
		bottom: 0px;
		left: 0px;
		background: rgba(0, 0, 0, 0.65);
	}

	@keyframes dialog-in {
        from {
            opacity: 0;
			filter: blur(15px);
        }
        to {
            opacity: 1;
			filter: blur(0px);
        }
    }

    @keyframes backdrop-in {
        from {
            opacity: 0;
			filter: blur(15px);
        }
        to {
            opacity: 1;
			filter: blur(0px);
        }
    }

    .open\:animate-in[open] {
        animation: dialog-in 0.2s ease-in-out forwards;
    }

    .open\:animate-in[open]::backdrop {
        animation: backdrop-in 0.2s ease-in-out forwards;
    }
</style>

<button>
	<slot name="trigger" />
</button>

<dialog
	id={id}
	class="bg-background border-muted/30 max-h-[50%] min-h-[50%] w-[90%] border p-5 sm:w-[70%] md:w-[60%] lg:w-[50%] xl:w-[30%] xl:min-w-[600px] backdrop:bg-background/50 backdrop:backdrop-blur-sm open:animate-in"
>
	<div>
		<slot name="main" />
		<div>
			<form method="dialog">
				<slot name="close" />
			</form>
		</div>
	</div>
</dialog>

<script define:vars={{ id }}>
	function setupModal() {
		const dialog = document.getElementById(id);
		const openButton = dialog?.previousElementSibling;

		if (!dialog || !openButton) return;

		openButton.addEventListener("click", () => {
			dialog.showModal();
		});

		// Close the modal when clicking outside the dialog content
		dialog.addEventListener("click", (event) => {
			const rect = dialog.getBoundingClientRect();
			const isInDialog =
				event.clientX >= rect.left &&
				event.clientX <= rect.right &&
				event.clientY >= rect.top &&
				event.clientY <= rect.bottom;

			if (!isInDialog) {
				dialog.close();
			}
		});
	}

	// Run on initial load.
	setupModal();

	// Re-run after every view transition.
	document.addEventListener("astro:after-swap", setupModal);
</script>
